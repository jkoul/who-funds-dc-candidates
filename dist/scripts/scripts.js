"use strict";angular.module("app",["ngAnimate","ngAria","ngCookies","ngMessages","ngResource","ngSanitize","ui.router","ngMaterial"]).constant("assetPath",".").config(["$mdThemingProvider",function(a){a.disableTheming()}]).config(["$locationProvider",function(a){a.html5Mode(!0)}]),angular.module("app").config(["$stateProvider","$urlServiceProvider","$urlRouterProvider",function(a,b,c){c.when("","/"),a.state("main",{"abstract":!0,templateUrl:"views/main.html",controller:"MainCtrl",resolve:{mainData:["Race","Candidate","Campaign","$q",function(a,b,c,d){return d.all([a.get(),b.get(),c.get()])}]}}).state("main.home",{url:"/",templateUrl:"views/pages/home.html",controller:"HomeCtrl"}).state("main.races",{"abstract":!0,controller:"RacesCtrl"}).state("main.races.index",{url:"/races",templateUrl:"views/pages/races.html"}).state("main.campaigns",{"abstract":!0,controller:"CampaignsCtrl"}).state("main.campaigns.index",{url:"/campaigns",templateUrl:"views/pages/campaigns.html"})}]),angular.module("app").controller("MainCtrl",["$scope","mainData",function(a,b){a.main={races:b[0].data,candidates:b[1].data,campaigns:b[2].data}}]),angular.module("app").controller("HomeCtrl",function(){this.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}),angular.module("app").controller("RacesCtrl",["$scope","$filter",function(a,b){a.campaigns=b("candidateName")(a.main.campaigns,a.main.candidates)}]),angular.module("app").controller("CampaignsCtrl",function(){this.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}),angular.module("app").factory("Race",["$http","assetPath",function(a,b){return{get:function(){return a.get(b+"/api/race.json")}}}]),angular.module("app").factory("Campaign",["$http","assetPath",function(a,b){return{get:function(){return a.get(b+"/api/campaign.json")}}}]),angular.module("app").factory("Candidate",["$http","assetPath",function(a,b){return{get:function(){return a.get(b+"/api/candidate.json")}}}]),angular.module("app").factory("Contribution",["$http","$q","$filter",function(a,b,c){var d="https://maps2.dcgis.dc.gov/dcgis/rest/services/DCGIS_DATA/Public_Service_WebMercator/MapServer/34/query",e=function(a){var b=[],c=Object.keys(a);if(c.length){angular.forEach(c,function(c){var d="string"==typeof a[c]?c+"='"+a[c]+"'":c+"="+a[c];b.push(d)});var d=b.join(" AND ");return d}return"1=1"};return{get:function(f){return a.get(d+"?where="+e(f)+"&outFields=*&f=json").then(function(a){var b=[];return angular.forEach(a.data.features,function(a){var d={address:a.attributes.ADDRESS,addressId:a.attributes.ADDRESS_ID,amount:a.attributes.AMOUNT,candidateName:a.attributes.CANDIDATENAME,committeeName:a.attributes.COMMITTEENAME,contributionType:a.attributes.CONTRIBUTIONTYPE,contributorName:a.attributes.CONTRIBUTORNAME,contributorType:a.attributes.CONTRIBUTORTYPE,dateReceived:c("date")(a.attributes.DATEOFRECEIPT,"MM/dd/yyyy"),electionYear:a.attributes.ELECTIONYEAR,employer:a.attributes.EMPLOYER,employerAddress:a.attributes.EMPLOYERADDRESS,normalizedAddress:a.attributes.FULLADDRESS,lat:a.attributes.LATITUDE,"long":a.attributes.LONGITUDE,objectId:a.attributes.OBJECTID};b.push(d)}),b},function(a){return b.reject(a)})}}}]),angular.module("app").filter("candidateName",["$filter",function(a){return function(b,c){var d=function(b){if(b.candidateId){var d=a("filter")(c,{id:b.candidateId},!0);return 1===d.length?d[0].name:"Unnamed Candidate"}return b.committeeName};return b&&b.length?(angular.forEach(b,function(a){return angular.extend(a,{candidateName:d(a)})}),b):void 0}}]),angular.module("app").directive("campaignDetail",["Contribution","$filter",function(a,b){return{restrict:"A",scope:!0,link:function(c){c.campaign&&c.campaign.id&&a.get({COMMITTEENAME:c.campaign.committeeName}).then(function(a){c.contribs=b("newContributions")(a);var d=function(a){var b=0;return angular.forEach(a,function(a){b+=a.amount}),b},e=a.length,f=b("filter")(c.contribs,function(a){return a.addressId}),g=b("filter")(c.contribs,function(a){return a.amount<100}),h=b("filter")(c.contribs,function(a){return a.amount===c.race.contributionLimit});c.summaryData={contribsCount:e,totalRaised:d(c.contribs),dcContribs:f.length,totalRaisedFromDc:d(f),smallContribs:g.length,contribsAtMax:h.length}})}}}]),angular.module("app").filter("newContributions",["$filter",function(a){return function(b){return a("filter")(b,function(a){return"Committee"!==a.contributorType})}}]),angular.module("app").directive("campaignCard",function(){return{templateUrl:"views/components/campaign-card.html",restrict:"E",transclude:!0}}),angular.module("app").run(["$templateCache",function(a){a.put("views/components/campaign-card.html",'<md-card class="campaign-card"> <md-card-header class="card-header"> <md-card-header-text> <span class="md-title">{{campaign.candidateName}}</span> <span class="md-subhead">{{campaign.committeeName}}</span> </md-card-header-text> </md-card-header> <md-card-title> <md-card-title-text> <span class="md-headline">Details</span> </md-card-title-text> </md-card-title> <md-card-content> <div campaign-detail> <div class="campaign-summary-section"> <div>Total Contributions: <span ng-if="contribs.length == 1000">&gt;</span>{{summaryData.contribsCount}}</div> <!-- <div>Total from DC: {{summaryData.dcContribs}}<span ng-if="contribs.length == 1000"> (of those 1000)</span></div> --> <div>Contributions from DC: {{((summaryData.dcContribs / summaryData.contribsCount)*100).toFixed(2)}}%</div> </div> <div class="campaign-summary-section"> <div>Total Raised: <span ng-if="contribs.length == 1000">&gt;</span>{{summaryData.totalRaised | currency}}</div> <!-- <div>Total Raised from DC: {{summaryData.totalRaisedFromDc | currency}}</div> --> <div>Raised from DC: {{((summaryData.totalRaisedFromDc / summaryData.totalRaised)*100).toFixed(2)}}%</div> </div> <div class="campaign-summary-section"> <div>Average Contribution: {{(summaryData.totalRaised / summaryData.contribsCount) | currency}}</div> <div>% Small Contributions (&lt;$100): {{((summaryData.smallContribs / summaryData.contribsCount)*100).toFixed(2)}}%</div> <div>% Contributions at Max Allowed (${{race.contributionLimit}}): {{((summaryData.contribsAtMax / summaryData.contribsCount)*100).toFixed(2)}}%</div> </div> </div> <!-- campaign-detail --> </md-card-content> <!-- TODO: convert to grid cards and add "campaign-detail" directive --> </md-card>'),a.put("views/main.html",'<div class="layout-container"> <!-- HEADER --> <div id="header" class="header" ng-include="\'views/regions/header.html\'"></div> <!-- DEFER TO STATE-BASED VIEWS --> <md-content class="md-padding"> <div id="main" class="main" ui-view></div> </md-content> <!-- FOOTER --> <md-content class="md-padding"> <div id="footer" class="footer" ng-include="\'views/regions/footer.html\'"></div> </md-content> </div>'),a.put("views/pages/campaigns.html","<p>This is the campaigns view.</p>"),a.put("views/pages/home.html",'<div class="page-container"> <p>This is the home view. There will be more stuff here in due time.</p> <div class="home-container"> <a class="cta-button" ui-sref="main.races.index"><span class="cta-text">View Current Races</span></a> <!-- <h4>HTML5 Boilerplate</h4>\n    <p>\n      HTML5 Boilerplate is a professional front-end template for building fast, robust, and adaptable web apps or sites.\n    </p>\n\n    <h4>Angular</h4>\n    <p>\n      AngularJS is a toolset for building the framework most suited to your application development.\n    </p>\n\n    <h4>Karma</h4>\n    <p>Spectacular Test Runner for JavaScript.</p> --> </div> </div>'),a.put("views/pages/races.html",'<div class="page-container"> <div class="page-intro"> <h1 class="page-title">List of Races</h1> <p>Note: filters will go here</p> </div> <div class="races-list"> <div class="race" ng-repeat="race in main.races | filter:{electionYear:2018}"> <h2 class="race-headline">{{race.raceId}} - {{race.raceTypeDetail}} - {{race.electionYear}}</h2> <!-- set up grid for campaign cards --> <md-content class="race-candidates-list" layout-xs="column" layout="row" layout-wrap> <!-- <div ng-repeat="campaign in campaigns | filter:{raceId:race.raceId}"> --> <!-- <div>{{campaign.candidateName}}</div> --> <campaign-card flex-xs flex-gt-xs="50" flex-gt-sm="33" flex-gt-md="25" ng-repeat="campaign in campaigns | filter:{raceId:race.raceId}"> <!-- </div> --> </md-content> </div> </div> </div>'),a.put("views/regions/footer.html",'<div class="footer-inner"> <h2>Footer</h2> <p>&copy;2018 Jeremy Koulish. This site is a work in progress.</p> </div>'),a.put("views/regions/header.html",'<md-content class="md-padding"> <md-nav-bar nav-bar-aria-label="navigation links" role="navigation"> <!-- <div class="navbar-header"> --> <!-- <a class="navbar-brand" href="/">Who Funds DC Candidates?</a> --> <!-- </div> --> <md-nav-item md-nav-sref="main.home" name="main.home" aria-label="home">Home</md-nav-item> <md-nav-item md-nav-sref="main.races.index" name="main.races.index" aria-label="races">Races</md-nav-item> <md-nav-item md-nav-sref="main.campaigns.index" name="main.campaigns.index" aria-label="campaigns">Campaigns</md-nav-item> </md-nav-bar> </md-content>')}]);