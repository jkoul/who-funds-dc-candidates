"use strict";angular.module("app",["ngMaterial","ngAnimate","ngAria","ngCookies","ngMessages","ngResource","ngSanitize","ui.router","angular.filter"]).constant("assetPath",".").config(["$locationProvider",function(a){a.html5Mode(!0)}]),angular.module("app").config(["$stateProvider","$urlServiceProvider","$urlRouterProvider",function(a,b,c){c.when("","/"),a.state("main",{"abstract":!0,templateUrl:"views/main.html",controller:"MainCtrl",resolve:{mainData:["Race","Campaign","$q",function(a,b,c){return c.all([a.get(),b.get()])}]}}).state("main.home",{url:"/",templateUrl:"views/pages/home.html",controller:"HomeCtrl"}).state("main.races",{"abstract":!0,controller:"RacesCtrl"}).state("main.races.index",{url:"/races",templateUrl:"views/pages/races.html"}).state("main.campaigns",{"abstract":!0,controller:"CampaignsCtrl"}).state("main.campaigns.index",{url:"/campaigns",templateUrl:"views/pages/campaigns.html"})}]),angular.module("app").controller("MainCtrl",["$scope","$filter","mainData",function(a,b,c){a.main={races:c[0].data,campaigns:c[1].data,electionYears:b("electionYears")(c[0].data)}}]),angular.module("app").controller("HomeCtrl",function(){this.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}),angular.module("app").controller("RacesCtrl",["$scope","$filter",function(a,b){a.showRaces=!1,a.racesCtrl={activeYear:a.main.electionYears.reduce(function(a,b){return Math.max(a,b)}),getSelectedText:function(){return a.racesCtrl.filterRaces?angular.equals(b("orderBy")(a.racesCtrl.filterRaces,"raceId"),a.racesCtrl.activeRaces)?"Showing all races":"Showing "+a.racesCtrl.filterRaces.length+" of "+a.racesCtrl.activeRaces.length+" races":"Loading races..."}}}]),angular.module("app").controller("CampaignsCtrl",function(){this.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}),angular.module("app").factory("Race",["$http","assetPath",function(a,b){return{get:function(){return a.get(b+"/api/races.json")}}}]),angular.module("app").factory("Campaign",["$http","assetPath",function(a,b){return{get:function(){return a.get(b+"/api/campaigns.json")}}}]),angular.module("app").factory("Contribution",["$http","$q","$filter",function(a,b,c){var d="https://maps2.dcgis.dc.gov/dcgis/rest/services/DCGIS_DATA/Public_Service_WebMercator/MapServer/34/query",e=function(a){var b=[],c=Object.keys(a);if(c.length){angular.forEach(c,function(c){var d="string"==typeof a[c]?c+"='"+a[c]+"'":c+"="+a[c];b.push(d)});var d=b.join(" AND ");return d}return"1=1"};return{get:function(f){var g=1e3,h=function(c){return a.get(d+"?where="+e(c)+"&outFields=*&f=json").then(j,function(a){return b.reject(a)})},i=function(c){for(var e=b.defer(),f=0,g=200,h=[];f<c.length;){var i=c.slice(f,f+g).join(",");h.push(a.get(d+"?objectIds="+i+"&outFields=*&f=json")),f+=g}return b.all(h).then(function(a){var b={data:{features:[]}};angular.forEach(a,function(a){var c=a.data.features;angular.forEach(c,function(a){b.data.features.push(a)})}),e.resolve(j(b))}),e.promise},j=function(a){var b=[];return angular.forEach(a.data.features,function(a){var d={address:a.attributes.ADDRESS,addressId:a.attributes.ADDRESS_ID,amount:a.attributes.AMOUNT,candidateName:a.attributes.CANDIDATENAME,committeeName:a.attributes.COMMITTEENAME,contributionType:a.attributes.CONTRIBUTIONTYPE,contributorName:a.attributes.CONTRIBUTORNAME,contributorType:a.attributes.CONTRIBUTORTYPE,dateReceived:c("date")(a.attributes.DATEOFRECEIPT,"MM/dd/yyyy"),electionYear:a.attributes.ELECTIONYEAR,employer:a.attributes.EMPLOYER,employerAddress:a.attributes.EMPLOYERADDRESS,normalizedAddress:a.attributes.FULLADDRESS,lat:a.attributes.LATITUDE,"long":a.attributes.LONGITUDE,objectId:a.attributes.OBJECTID,ward:a.attributes.WARD};b.push(d)}),b};return a.get(d+"?returnGeometry=false&returnIdsOnly=true&f=json&where="+e(f)).then(function(a){var b=a.data.objectIds;return b?b&&b.length<=g?h(f):i(b):void 0},function(a){return b.reject(a)})}}}]),angular.module("app").filter("candidateName",["$filter",function(a){return function(b,c){var d=function(b){if(b.candidateId){var d=a("filter")(c,{id:b.candidateId},!0);return 1===d.length?d[0].name:"Unnamed Candidate"}return b.committeeName};return b&&b.length?(angular.forEach(b,function(a){return angular.extend(a,{candidateName:d(a)})}),b):void 0}}]),angular.module("app").filter("electionYears",["$filter",function(a){return function(b){if(!b||!b.length)return!1;var c=[];return angular.forEach(b,function(a){-1===c.indexOf(a.electionYear)&&c.push(a.electionYear)}),a("orderBy")(c)}}]),angular.module("app").directive("activeRaces",["$filter",function(a){return{restrict:"A",scope:!0,link:function(b){if(b.racesCtrl.activeYear){var c=function(c){return a("filter")(b.main.races,{electionYear:c})};b.racesCtrl.activeRaces=c(b.racesCtrl.activeYear);var d=function(a){return angular.copy(a)},e=function(a){b.racesCtrl.activeRaces=c(a),b.racesCtrl.filterRaces=d(b.racesCtrl.activeRaces)};b.$watch("racesCtrl.activeYear",function(a){e(a)})}}}}]),angular.module("app").directive("campaignDetail",["Contribution","$filter",function(a,b){return{restrict:"A",link:function(c){return c.campaign&&c.campaign.id?void a.get({COMMITTEENAME:c.campaign.committeeName}).then(function(a){c.contribs=b("newContributions")(a);var d=b("filter")(c.contribs,function(a){return a.amount===c.race.contributionLimit}),e=b("filter")(c.contribs,function(a){return a.contributorName===c.campaign.autoCandidateName||"Candidate"===a.contributorType},!0),f=b("groupBy")(a,"contributorName"),g=[];angular.forEach(f,function(a,c){var d=b("dcContributions")(a).length?!0:!1;g.push({name:c,totalRaised:b("totalRaised")(a),dcResident:d,contributions:a})});var h=b("filter")(g,function(a){return a.totalRaised===c.race.contributionLimit}),i=b("filter")(g,function(a){return a.totalRaised<100});c.summaryData={contribs:a,smallContribs:i,contribsAtMax:d.length,candidateContribs:e,contributors:g,maxDonors:h}}):void console.log("no campaign")}}}]),angular.module("app").filter("newContributions",["$filter",function(a){return function(b){return a("filter")(b,function(a){return"Committee"!==a.contributorType})}}]),angular.module("app").filter("dcContributions",["$filter",function(a){return function(b){return b&&b.length?a("filter")(b,function(a){return a.addressId||a.ward}):void 0}}]),angular.module("app").filter("totalRaised",function(){return function(a){if(a){var b=0;return angular.forEach(a,function(a){b+=a.amount}),b}}}),angular.module("app").directive("campaignCard",function(){return{templateUrl:"views/components/campaign-card.html",restrict:"E",transclude:!0}}),angular.module("app").filter("duplicateCampaigns",["$filter",function(a){return function(b,c){if(!b||!c.length)return!1;var d=a("filter")(c,function(a){return a.candidateName===b.candidateName&&a.raceId===b.raceId});return d.length>1}}]),angular.module("app").run(["$templateCache",function(a){a.put("views/components/campaign-card.html",'<md-card class="campaign-card"> <md-card-header class="card-header"> <md-card-header-text> <span class="md-title">{{campaign.candidateName}}</span> <span class="md-subhead">{{campaign.committeeName}}</span> </md-card-header-text> </md-card-header> <md-card-title> <md-card-title-text> <span class="md-headline">Details</span> </md-card-title-text> </md-card-title> <md-card-content> <div campaign-detail> <div class="campaign-summary-section"> <div>Total Contributions: {{summaryData.contribs.length}}</div> <div>Total from DC: {{(summaryData.contribs | dcContributions).length}} ({{(((summaryData.contribs | dcContributions).length / summaryData.contribs.length)*100).toFixed(1)}}% of total)</div> <div>Unique Contributors: {{summaryData.contributors.length}}</div> <div>Unique Contributors from DC: {{(summaryData.contributors | filter:{dcResident:true}).length}} ({{(((summaryData.contributors | filter:{dcResident:true}).length / summaryData.contributors.length)*100).toFixed(1)}}%)</div> </div> <div class="campaign-summary-section"> <div>Total Raised: {{summaryData.contribs | totalRaised | currency}}</div> <!-- <div>Total Raised from DC: {{summaryData.totalRaisedFromDc | currency}}</div> --> <div>Raised from DC: {{summaryData.contribs | dcContributions | totalRaised | currency}} ({{(((summaryData.contribs | dcContributions | totalRaised) / (summaryData.contribs | totalRaised))*100).toFixed(1)}}%)</div> <div>Contributions from Candidate: {{summaryData.candidateContribs | totalRaised | currency}}</div> <div>Max Contributors (${{race.contributionLimit}}): {{summaryData.maxDonors.length}} ({{((summaryData.maxDonors.length / summaryData.contributors.length)*100).toFixed(1)}}%)</div> </div> <div class="campaign-summary-section"> <div>Average Contribution: {{(summaryData.contribs | totalRaised) / (summaryData.contribs.length) | currency}}</div> <div>% Small Donors (&lt;$100): {{((summaryData.smallContribs.length / summaryData.contribs.length)*100).toFixed(1)}}%</div> </div> </div> <!-- campaign-detail --> </md-card-content> <!-- TODO: convert to grid cards and add "campaign-detail" directive --> </md-card>'),a.put("views/main.html",'<div class="layout-container"> <!-- HEADER --> <div id="header" class="header" ng-include="\'views/regions/header.html\'"></div> <!-- DEFER TO STATE-BASED VIEWS --> <md-content class="md-padding"> <div id="main" class="main" ui-view></div> </md-content> <!-- FOOTER --> <md-content class="md-padding"> <div id="footer" class="footer" ng-include="\'views/regions/footer.html\'"></div> </md-content> </div>'),a.put("views/pages/campaigns.html",'<p>This page is under construction.</p> <p><a class="cta-button" ui-sref="main.races.index"><span class="cta-text">View Races by Year</span></a></p>'),a.put("views/pages/home.html",'<div class="page-container"> <p>Who Funds DC Candidates is an application built on data from Washington DC\'s Office of Campaign Finance.</p> <div class="home-container"> <a class="cta-button" ui-sref="main.races.index"><span class="cta-text">View Races by Year</span></a> </div> </div>'),a.put("views/pages/races.html",'<div class="page-container"> <div class="page-intro"> <h1 class="page-title">Campaign Overviews by Race</h1> <div class="race-filters"> <h2>Filters:</h2> <md-input-container> <label>Year</label> <md-select ng-model="racesCtrl.activeYear"> <md-option ng-value="year" ng-repeat="year in main.electionYears">{{year}}</md-option> </md-select> </md-input-container> <md-input-container> <label>Select Races</label> <md-select ng-model="racesCtrl.filterRaces" ng-model-options="{trackBy: \'$value.raceId\'}" md-selected-text="racesCtrl.getSelectedText()" multiple> <md-option ng-value="race" ng-repeat="race in racesCtrl.activeRaces">{{race.raceTypeDetail}}</md-option> </md-select> </md-input-container> <!--<div class="races-list-toggle" active-races>\n        <md-button class="md-accent md-raised" ng-click="showRaces = !showRaces">Show Races</md-button>\n        <div class="races-list-container" ng-if="showRaces">\n          <h3>Races in {{racesCtrl.activeYear}}</h3>\n          <div class="races-active-list">\n            <md-chips ng-model="racesCtrl.filterRaces" readonly>\n              <md-chip-template>{{$chip.raceTypeDetail}}</md-chip-template>\n            </md-chips> \n          </div>\n        </div>\n      </div> --> </div> </div> <div class="races-list" active-races> <h2>Races in {{racesCtrl.activeYear}}</h2> <div class="race" ng-repeat="race in racesCtrl.filterRaces|orderBy:\'raceId\'"> <h3 class="race-headline">{{race.raceTypeDetail}} - {{race.electionYear}}</h3> <!-- set up grid for campaign cards --> <md-content class="race-candidates-list" layout-xs="column" layout="row" layout-wrap> <!-- <div ng-repeat="campaign in campaigns | filter:{raceId:race.raceId}"> --> <!-- <div>{{campaign.candidateName}}</div> --> <campaign-card flex-xs flex-gt-xs="50" flex-gt-sm="33" flex-gt-md="25" ng-repeat="campaign in main.campaigns | filter:{raceId:race.raceId}"> <!-- </div> --> </md-content> </div> </div> </div>'),a.put("views/regions/footer.html",'<div class="footer-inner"> <!-- <h2>Footer</h2> --> <p>&copy;2019 Jeremy Koulish. This site is a work in progress.</p> </div>'),a.put("views/regions/header.html",'<md-content class="md-padding header-content" layout-="column" layout-align="center center" layout-gt-sm="row" layout-align-gt-sm="space-between stretch"> <h1>Who Funds DC Candidates?</h1> <md-nav-bar nav-bar-aria-label="navigation links" role="navigation" class="navigation"> <!-- <div class="navbar-header"> --> <!-- <a class="navbar-brand" href="/">Who Funds DC Candidates?</a> --> <!-- </div> --> <md-nav-item md-nav-sref="main.home" name="main.home" aria-label="home">Home</md-nav-item> <md-nav-item md-nav-sref="main.races.index" name="main.races.index" aria-label="races">Races</md-nav-item> <md-nav-item md-nav-sref="main.campaigns.index" name="main.campaigns.index" aria-label="campaigns">Campaigns</md-nav-item> </md-nav-bar> </md-content>')}]);